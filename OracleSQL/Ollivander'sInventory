Score:30|Diff:Med

SELECT ID,AGE,CN,PW FROM
(SELECT W.ID ID,WP.AGE AGE,W.COINS_NEEDED CN,W.POWER PW, RANK() OVER (PARTITION BY W.POWER,WP.AGE ORDER BY W.COINS_NEEDED) RNK
FROM WANDS W
INNER JOIN WANDS_PROPERTY WP ON W.CODE=WP.CODE
WHERE WP.IS_EVIL=0
ORDER BY W.POWER DESC,WP.AGE DESC,W.COINS_NEEDED,W.ID)
WHERE RNK=1;
